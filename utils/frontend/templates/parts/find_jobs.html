<div id="findJobsModal" class="modal-overlay">
    <div class="modal-content transition-all duration-300">
        <!-- Config View -->
        <div id="modalConfigView">
            <!-- Header -->
            <div class="modal-header">
                <h2 class="text-xl font-bold text-slate-800 dark:text-white">Find Jobs Configuration</h2>
                <div class="flex items-center gap-3">
                    <button id="helpBtn" class="text-sm font-medium text-primary-600 dark:text-neon-blue hover:text-primary-700 dark:hover:text-cyan-400 flex items-center gap-2 transition-colors">
                        <i class="fa-regular fa-circle-question"></i> <span class="hidden sm:inline">How to Use</span>
                    </button>
                    <div class="w-px h-6 bg-slate-200 dark:bg-slate-700 mx-1"></div>
                    <button class="modal-close text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="modal-body custom-scrollbar">
                <!-- Search Terms -->
                <div class="form-group">
                    <label class="form-label flex items-center gap-2">
                        <span>Search Terms <span class="text-xs text-slate-500 font-normal">(What to search for)</span></span>
                        <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-search-terms">
                            <i class="fa-solid fa-circle-info text-xs"></i>
                        </button>
                    </label>
                    <div class="tag-input-container" id="searchTermsInput">
                        <input type="text" class="tag-input-field dark:text-white" placeholder="Add search term and press Enter...">
                    </div>
                </div>

                <!-- Location -->
                <div class="form-group">
                    <label class="form-label flex items-center gap-2">
                        <span>Location <span class="text-xs text-slate-500 font-normal">(Optional)</span></span>
                        <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-location">
                            <i class="fa-solid fa-circle-info text-xs"></i>
                        </button>
                    </label>
                    <input type="text" id="locationInput" class="w-full px-3 py-2 border border-slate-300 dark:border-neon-border rounded-lg bg-white dark:bg-neon-gray text-slate-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 placeholder-slate-400 dark:placeholder-slate-500" placeholder="City, State (e.g. San Francisco, CA)">
                    <p class="text-[10px] text-slate-400 mt-1 ml-1">Use 2-letter state code (e.g. CA, NY)</p>
                </div>

                <!-- Hours Old -->
                <div class="form-group">
                    <label class="form-label flex items-center gap-2">
                        Job Posting Age
                        <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-age">
                            <i class="fa-solid fa-circle-info text-xs"></i>
                        </button>
                    </label>
                    <div class="flex items-center gap-4 mb-2">
                        <input type="range" id="hoursOldSlider" min="0" max="5" step="1" class="flex-1">
                        <span id="hoursOldDisplay" class="text-sm font-bold text-primary-600 dark:text-neon-blue w-32 text-right">24 hours</span>
                    </div>
                </div>

                <!-- Sites -->
                <div class="form-group">
                    <label class="form-label flex items-center gap-2">
                        Sites to Scrape
                        <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-sites">
                            <i class="fa-solid fa-circle-info text-xs"></i>
                        </button>
                    </label>
                    <div class="checkbox-grid" id="sitesContainer">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                
                <!-- Filters Divider -->
                <div class="border-t border-slate-200 dark:border-neon-border my-6"></div>
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Filters</h3>

                <!-- Job Title Keywords -->
                <div class="form-group">
                    <div class="flex justify-between items-end mb-2">
                        <label class="form-label mb-0 flex items-center gap-2">
                            <span>Title Keywords <span class="text-xs text-slate-500 font-normal block sm:inline">(Match ANY keyword in EACH section)</span></span>
                            <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-title-keywords">
                                <i class="fa-solid fa-circle-info text-xs"></i>
                            </button>
                        </label>
                        <button type="button" id="addTitleSectionBtn" class="text-xs px-2 py-1 rounded bg-slate-100 dark:bg-neon-gray hover:bg-slate-200 dark:hover:bg-neon-border text-primary-600 dark:text-neon-blue font-bold transition-colors">
                            + Add AND Section
                        </button>
                    </div>
                    <!-- Container for dynamic sections -->
                    <div id="jobTitlesSectionsContainer" class="flex flex-col gap-3">
                         <!-- Sections will be injected here via JS -->
                    </div>
                </div>

                <!-- Description Keywords -->
                <div class="form-group">
                    <div class="flex justify-between items-end mb-2">
                        <label class="form-label mb-0 flex items-center gap-2">
                            <span>Description Keywords <span class="text-xs text-slate-500 font-normal block sm:inline">(Match ANY keyword in EACH section)</span></span>
                            <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-desc-keywords">
                                <i class="fa-solid fa-circle-info text-xs"></i>
                            </button>
                        </label>
                        <button type="button" id="addDescSectionBtn" class="text-xs px-2 py-1 rounded bg-slate-100 dark:bg-neon-gray hover:bg-slate-200 dark:hover:bg-neon-border text-primary-600 dark:text-neon-blue font-bold transition-colors">
                            + Add AND Section
                        </button>
                    </div>
                     <!-- Container for dynamic sections -->
                    <div id="descKeywordsSectionsContainer" class="flex flex-col gap-3">
                        <!-- Sections will be injected here via JS -->
                    </div>
                </div>
                
                 <!-- Results Wanted -->
                <div class="form-group">
                    <div class="flex items-center justify-between">
                        <div>
                            <label class="form-label flex items-center gap-2">
                                Max Results Per Search
                                <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-results">
                                    <i class="fa-solid fa-circle-info text-xs"></i>
                                </button>
                            </label>
                            <input type="number" id="resultsWantedInput" class="w-24 px-3 py-2 border border-slate-300 dark:border-neon-border rounded-lg bg-white dark:bg-neon-gray text-slate-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-primary-500" value="20" min="5" max="50">
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="refineDescriptionsCheckbox" class="w-4 h-4 text-primary-600 dark:text-neon-blue bg-slate-100 dark:bg-neon-gray border-slate-300 dark:border-neon-border rounded focus:ring-primary-500 dark:focus:ring-neon-blue focus:ring-2">
                            <label for="refineDescriptionsCheckbox" class="form-label mb-0 flex items-center gap-2">
                                Refine Descriptions with LLM
                                <button type="button" class="info-btn text-slate-400 hover:text-primary-500 dark:hover:text-neon-blue transition-colors" data-help-section="help-refine">
                                    <i class="fa-solid fa-circle-info text-xs"></i>
                                </button>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer">
                <button class="modal-close px-4 py-2 rounded-lg text-sm font-medium text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-neon-border/50 transition-colors">
                    Cancel
                </button>
                <button id="startScrapeBtn" class="px-6 py-2 rounded-lg text-sm font-bold bg-primary-600 dark:bg-neon-blue text-white dark:text-black hover:bg-primary-700 dark:hover:bg-cyan-400 shadow-md transition-all flex items-center gap-2">
                     Start Scraping <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Progress View (Hidden initially) -->
        <div id="modalProgressView" class="hidden h-full flex flex-col">
            <div class="modal-header">
                <h2 class="text-xl font-bold text-slate-800 dark:text-white">Scraping in Progress</h2>
            </div>
            <div class="modal-body flex-1 flex flex-col justify-center items-center gap-6">
                
                <!-- Progress Ring/Icon -->
                <div class="relative w-24 h-24">
                    <div class="absolute inset-0 border-4 border-slate-200 dark:border-neon-gray-light rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-primary-500 dark:border-neon-blue rounded-full border-t-transparent animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="progressPercent" class="text-xl font-bold text-slate-700 dark:text-white">0%</span>
                    </div>
                </div>

                <!-- Status Text -->
                <div class="text-center">
                    <h3 id="progressStage" class="text-lg font-bold text-slate-900 dark:text-white mb-2">Initializing...</h3>
                    <p id="progressMessage" class="text-sm text-slate-500 dark:text-gray-400 max-w-sm mx-auto">Please wait while we search for jobs...</p>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-2 gap-4 w-full max-w-sm">
                    <div class="bg-slate-50 dark:bg-neon-gray/50 p-4 rounded-lg text-center border border-slate-200 dark:border-neon-border">
                        <div id="jobsFoundCount" class="text-2xl font-bold text-primary-600 dark:text-neon-blue">0</div>
                        <div class="text-xs text-slate-500 dark:text-gray-400 uppercase tracking-wide">Jobs Found</div>
                    </div>
                    <div class="bg-slate-50 dark:bg-neon-gray/50 p-4 rounded-lg text-center border border-slate-200 dark:border-neon-border">
                        <div id="jobsSavedCount" class="text-2xl font-bold text-green-600 dark:text-neon-green">0</div>
                        <div class="text-xs text-slate-500 dark:text-gray-400 uppercase tracking-wide">New Jobs</div>
                    </div>
                </div>
            </div>
            
            <!-- Completed Actions -->
            <div id="progressActions" class="modal-footer hidden">
                <button id="progressCloseBtn" class="w-full px-6 py-2 rounded-lg text-sm font-bold bg-primary-600 dark:bg-neon-blue text-white dark:text-black hover:bg-primary-700 dark:hover:bg-cyan-400 transition-all">
                    View Jobs
                </button>
            </div>
        </div>

    </div>

    <!-- Help Panel -->
    <div id="helpPanel" class="help-panel fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white dark:bg-[#1a1a1a] shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col border-l border-slate-200 dark:border-[#2a2a2a]">
        <!-- Panel Header -->
        <div class="p-5 border-b border-slate-200 dark:border-[#2a2a2a] flex justify-between items-center bg-slate-50 dark:bg-[#202020]">
            <h3 class="text-lg font-bold text-slate-800 dark:text-white flex items-center gap-2">
                <i class="fa-regular fa-circle-question text-primary-600 dark:text-neon-blue"></i>
                Help & Guide
            </h3>
            <button id="closeHelpBtn" class="text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors">
                <i class="fa-solid fa-times text-lg"></i>
            </button>
        </div>

        <!-- Panel Body (Accordion) -->
        <div class="flex-1 overflow-y-auto p-5 space-y-4 custom-scrollbar">
            
            <div class="accordion-item" id="help-search-terms">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Search Terms</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Enter the main job titles or roles you are looking for (e.g., "Software Engineer", "Data Scientist"). These are the primary terms used to query job boards.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-location">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Location</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Specify a city and state (e.g., "Seattle, WA") to narrow down results. If left blank, some sites may default to your IP location or "Remote". Use the 2-letter state code for best results.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-age">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Job Posting Age</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Filter jobs by when they were posted. "24 hours" is best for finding the freshest listings. <br><br><strong>Note:</strong> Older listings may be expired or already flooded with applicants.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-sites">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Sites to Scrape</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Select which job boards to search. LinkedIn and Indeed usually have the highest volume. Glassdoor and ZipRecruiter are good supplements.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-title-keywords">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Title Keywords (Logic)</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400 space-y-2">
                    <p>This filter uses <strong>AND/OR</strong> logic to strictly filter results by job title.</p>
                    <ul class="list-disc pl-4 space-y-1">
                        <li><strong>Groups (AND):</strong> The job title must match <em>at least one</em> keyword from <strong>EVERY</strong> group you create.</li>
                        <li><strong>Keywords (OR):</strong> Within a single group, the job title can match <strong>ANY</strong> of the keywords.</li>
                    </ul>
                    <p class="text-xs italic mt-2 bg-slate-100 dark:bg-slate-800 p-2 rounded">
                        <strong>Example:</strong><br>
                        Group 1: "Senior", "Lead"<br>
                        Group 2: "Python", "Backend"<br>
                        Matches: "Senior Python Dev", "Lead Backend Eng"<br>
                        Fails: "Junior Python Dev", "Senior Java Dev"
                    </p>
                </div>
            </div>

            <div class="accordion-item" id="help-desc-keywords">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Description Keywords (Logic)</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Same logic as Title Keywords, but checks the full job description text. Use this to ensure specific skills (e.g., "React", "AWS") are mentioned in the body of the listing.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-results">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Max Results</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>The maximum number of jobs to fetch per search term per site. Higher numbers take longer to scrape.</p>
                </div>
            </div>

            <div class="accordion-item" id="help-refine">
                <button class="accordion-header w-full text-left flex justify-between items-center py-2 font-medium text-slate-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-neon-blue transition-colors">
                    <span>Refine Descriptions</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-200"></i>
                </button>
                <div class="accordion-content hidden pt-2 pb-4 text-sm text-slate-600 dark:text-gray-400">
                    <p>Uses an LLM to clean up and structure the job description into a standardized format. <br><br><strong class="text-amber-500">Note:</strong> This requires the page scraper to be active and may significantly increase processing time.</p>
                </div>
            </div>

        </div>
    </div>
</div>
